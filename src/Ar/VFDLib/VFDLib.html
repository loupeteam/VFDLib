<!-- 
*
* File: VFDLib.html
* Copyright (c) 2023 Loupe
* https://loupe.team
* 
* This file is part of VFDLib, licensed under the MIT License.
*
*
-->

<!doctype html>
<html>
<head>
<meta charset="utf-8">
<style>
*{margin:0;padding:0;}
body {
	font:13.34px helvetica,arial,freesans,clean,sans-serif;
	color:black;
	line-height:1.4em;
	background-color: #F8F8F8;
	padding: 0.7em;
}
p {
	margin:1em 0;
	line-height:1.5em;
}
table {
	font-size:inherit;
	font:100%;
	margin:1em;
}
table th{border-bottom:1px solid #bbb;padding:.2em 1em;}
table td{border-bottom:1px solid #ddd;padding:.2em 1em;}
input[type=text],input[type=password],input[type=image],textarea{font:99% helvetica,arial,freesans,sans-serif;}
select,option{padding:0 .25em;}
optgroup{margin-top:.5em;}
pre,code{font:12px Monaco,"Courier New","DejaVu Sans Mono","Bitstream Vera Sans Mono",monospace;}
pre {
	margin:1em 0;
	font-size:12px;
	background-color:#eee;
	border:1px solid #ddd;
	padding:5px;
	line-height:1.5em;
	color:#444;
	overflow:auto;
	-webkit-box-shadow:rgba(0,0,0,0.07) 0 1px 2px inset;
	-webkit-border-radius:3px;
	-moz-border-radius:3px;border-radius:3px;
}
pre code {
	padding:0;
	font-size:12px;
	background-color:#eee;
	border:none;
}
code {
	font-size:12px;
	background-color:#f8f8ff;
	color:#444;
	padding:0 .2em;
	border:1px solid #dedede;
}
img{border:0;max-width:100%;}
abbr{border-bottom:none;}
a{color:#4183c4;text-decoration:none;}
a:hover{text-decoration:underline;}
a code,a:link code,a:visited code{color:#4183c4;}

h1,h2,h3,h4,h5,h6{border:0;}

h1{font-size:200%;margin-top:1em;margin-bottom:1em}

h2{font-size:170%;padding-bottom:.5em;border-bottom:1px solid #d0d0d0;margin-top:1em;}

h3{margin-top:1em;}

hr{border:1px solid #ddd;}
ul{margin:1em 0 1em 2em;}
ol{margin:1em 0 1em 2em;}
ul li,ol li{margin-top:.5em;margin-bottom:.5em;}
ul ul,ul ol,ol ol,ol ul{margin-top:0;margin-bottom:0;}

blockquote{margin:1em 0;border-left:5px solid #ddd;padding-left:.6em;color:#555;}

dt{font-weight:bold;margin-left:1em;}
dd{margin-left:2em;margin-bottom:1em;}
@media screen and (min-width: 768px) {
    body {
        width: 748px;
        margin:10px auto;
    }
}
</style>
<title>VFDLib Library</title>
</head>
<body>
<p><img src="http://automationresourcesgroup.com/images/arglogo254x54.png" alt="Automation Resources Group" /></p>

<h1>VFDLib Library</h1>

<p>The VFDLib library provides a clean interface for basic control of variable frequency drives (VFDs).</p>

<h1>Usage</h1>

<p>The VFDLib functionality can be integrated into any project using a data structure and a function call. For an example of how to use this in a project, please see the ARG Automation Studio Starter Project at <a href="https://github.com/autresgrp/StarterProject">https://github.com/autresgrp/StarterProject</a>.</p>

<h2>Initialization</h2>

<p>To use the VFDLib functionality, a variable must be declared of type <strong>VFD_typ</strong>. This variable should then be initialized in the INIT routine of your program. This initialization consists of setting configuration settings and initial motion parameters.</p>

<pre><code>VFD.IN.CFG.Scale.MinUnits:= 0;
VFD.IN.CFG.Scale.MinRPM:=   0;
VFD.IN.CFG.Scale.MaxUnits:= 1500;
VFD.IN.CFG.Scale.MaxRPM:=   1500;

VFD.IN.PAR.Velocity:=       100;
</code></pre>

<p>The interface from the VFD variable to the VFD hardware is done via IO mappings. All necessary IO points are contained in the VFD.IOMap structure. These IO points are named consistently with the IO mapping entry names for the VFDs.</p>

<h2>Cyclic Operation</h2>

<p>To control the axis cyclically, the <strong>VFDFn_Cyclic()</strong> function must be called in the CYCLIC routine of your program, once every scan, unconditionally. This function should not be called on the same VFD variable more than once per scan.</p>

<pre><code>VFDFn_Cyclic( VFD );
</code></pre>

<p>The VFD variable can then be used as an interface for higher level motion sequencing programs.</p>

<h1>Reference</h1>

<h2>VFD Data Structure</h2>

<p>The main data structure of the VFDLib library is the VFD structure (VFD_typ datatype). This provides the interface to higher level programs and also stores all necessary internal information. It is divided into inputs (VFD.IN), outputs (VFD.OUT), a test interface (VFD.TEST), IO points (VFD.IOMap), an encoder structure (VFD.Encoder) and internals (VFD.Internal).</p>

<h3>Inputs</h3>

<p>The VFD inputs are divided into commands (IN.CMD), parameters (IN.PAR), and configuration settings (IN.CFG). Commands are used to initiate operations, and parameters and configuration settings determine how the commands will be processed. The difference between parameters and configuration settings is that configuration settings are generally set only once, while parameters might be set any time a command is issued.</p>

<h4>Commands</h4>

<ul>
<li><strong>Power</strong> - Power the motor. If set to 1, the motor will be powered. If set to 0, the motor will be depowered.</li>
<li><strong>Run</strong> - Run the motor at speed. If set to 1, the motor will run at the specified <strong>Velocity</strong>. If set to 0, the motor will stop.</li>
<li><strong>Reverse</strong> - Reverse the direction of motion.</li>
<li><strong>AcknowledgeError</strong> - Acknowledge any errors on the VFD.</li>
<li><strong>Restart</strong> - Restart the VFD after a fault has occurred.</li>
</ul>


<h4>Parameters</h4>

<ul>
<li><strong>Velocity</strong> - Velocity for motion. [units]</li>
</ul>


<h4>Configuration Settings</h4>

<ul>
<li><strong>Scale</strong> - These settings specify the scaling between velocity units and the native VFD units, RPM. The four settings constitute a point pair used for linear scaling.</li>
</ul>


<h3>Outputs</h3>

<p>The VFD outputs contain status information (OUT.STAT).</p>

<ul>
<li><strong>ActualVelocity</strong> - Current motor velocity. [units]</li>
<li><strong>ActualVelocity_RPM</strong> - Current motor velocity. [RPM]</li>
<li><strong>DriveStatus</strong>, <strong>Extended</strong> - Extended drive status information. See the ACOPOSinverter help for details.</li>
<li><strong>State</strong> - Current VFD state.</li>
<li><strong>Error</strong> - An error exists for the axis. <strong>Error</strong> is reset with the <strong>AcknowledgeError</strong> command.</li>
<li><strong>ErrorID</strong> - Current error ID number.</li>
<li><strong>ErrorString</strong> - Current error text.</li>
</ul>


<h3>Test Interface</h3>

<p>The test interface gives you direct access to the axis commands and parameters, interrupting any commands from higher level programs. This allows for easy testing of the axis during machine commissioning or servicing. <strong>The test commands and parameters are intended for use in an Automation Studio watch window and SHOULD NOT BE SET IN PROGRAMS</strong>.</p>

<ul>
<li><strong>Enable</strong> - If set to 1, TEST.CMD and TEST.PAR take priority over IN.CMD and IN.PAR. If set to 0, then TEST.CMD and TEST.PAR are ignored.</li>
<li><strong>CMD</strong> - Test commands. See above for a full list of commands.</li>
<li><strong>PAR</strong> - Test parameters. See above for a full list of parameters.</li>
<li><strong>STAT</strong> - A reduced set of status information that is always available whether test mode is enabled or not.</li>
</ul>


<h3>Encoder</h3>

<p>The VFD.Encoder structure is divided into inputs (Encoder.IN), and outputs (Encoder.OUT)</p>

<h4>Encoder Inputs</h4>

<ul>
<li><strong>Counter</strong> - Encoder position input. <strong>THIS VARIABLE SHOULD NOT BE MAPPED TO IO OR SET IN PROGRAMS. It is automatically set to VFD.IOMap.IN.Counter.</strong></li>
<li><strong>CFG.Scale</strong> - These specify the scaling between velocity units and encoder counts per second. The four settings constitute a point pair for linear scaling.</li>
<li><strong>CFG.tf</strong>, <strong>CFG.deadband</strong>, <strong>CFG.K</strong> - These settings configure the internal speed estimator used to report the current encoder speed. For details on these parameters, please see the documentation for the SpdEstLib library.</li>
</ul>


<h4>Encoder Outputs</h4>

<ul>
<li><strong>SpeedUnits</strong> - Encoder speed in units/s.</li>
<li><strong>SpeedCounts</strong> - Encoder speed in counts/s.</li>
<li><strong>STAT.Error</strong> - Encoder scaling error exists. <strong>Error</strong> is automatically reset when the scaling error is corrected.</li>
</ul>


<h2>Error ID Numbers</h2>

<ul>
<li>3 - &ldquo;CFF&rdquo;: Incorrect configuration (parameters)</li>
<li>4 - &ldquo;CFI&rdquo;: Invalid configuration (parameters)</li>
<li>5 - &ldquo;SLF&rdquo;: Modbus communication interruption</li>
<li>6 - &ldquo;ILF&rdquo;: Internal communication interruption</li>
<li>7 - &ldquo;CnF&rdquo;: Communication option card</li>
<li>8 - &ldquo;EPF&rdquo;: External fault</li>
<li>9 - &ldquo;OCF&rdquo;: Overcurrent</li>
<li>10 - &ldquo;CrF&rdquo;: Capacitor pre-charge</li>
<li>13 - &ldquo;LFF&rdquo;: 4 - 20 mA loss</li>
<li>16 - &ldquo;OHF&rdquo;: Drive overheating</li>
<li>17 - &ldquo;OLF&rdquo;: Motor overload</li>
<li>18 - &ldquo;ObF&rdquo;: DC bus overvoltage</li>
<li>19 - &ldquo;OSF&rdquo;: Line supply overvoltage</li>
<li>20 - &ldquo;OPF&rdquo;: Motor phase loss</li>
<li>21 - &ldquo;PHF&rdquo;: Line phase loss</li>
<li>22 - &ldquo;USF&rdquo;: Line supply undervoltage</li>
<li>23 - &ldquo;OCF&rdquo;: Motor short-circuit (phase to phase)</li>
<li>24 - &ldquo;SOF&rdquo;: Motor overspeed</li>
<li>25 - &ldquo;tnF&rdquo;: Auto-tuning was unsuccessful</li>
<li>26 - &ldquo;IF1&rdquo;: Unknown rating</li>
<li>27 - &ldquo;IF2&rdquo;: MMI card</li>
<li>28 - &ldquo;IF3&rdquo;: MMI communication</li>
<li>29 - &ldquo;IF4&rdquo;: Industrial EEPROM</li>
<li>30 - &ldquo;EEF&rdquo;: EEPROM memory</li>
<li>31 - &ldquo;OCF&rdquo;: Impeding short-circuit</li>
<li>32 - &ldquo;SCF&rdquo;: Motor short-circuit (to ground)</li>
<li>33 - &ldquo;OPF&rdquo;: Motor phase loss - 3 phases</li>
<li>34 - &ldquo;COF&rdquo;: Communication interruption, fault line 2 (CANopen)</li>
<li>35 - &ldquo;bLF&rdquo;: Brake control</li>
<li>36 - &ldquo;OCF&rdquo;: Power module, specific to 15kW drives</li>
<li>55 - &ldquo;SCF&rdquo;: Power module or motor short-circuit, detected at power up.</li>
</ul>

</body>
</html>